<!doctype html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Spectrum SoC &middot; Eletei
    
  </title>

  <link rel="stylesheet" href="http://localhost:4000/public/css/poole.css">
  <link rel="stylesheet" href="http://localhost:4000/public/css/syntax.css">
  <link rel="stylesheet" href="http://localhost:4000/public/css/hyde.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">

  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://localhost:4000/public/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="http://localhost:4000/public/favicon.ico">

  <link rel="alternate" type="application/rss+xml" title="RSS" href="http://localhost:4000/atom.xml">
</head>

  <body>

    <div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <h1>
        <a href="">
          Eletei
        </a>
      </h1>
      <p class="lead">Made by yours truly. </br></br>Fact: the masses will enter the the critical stage of the dejection process in around a 8.0 years. Until then, we shall meet again.</br></br></p>
    </div>

    <nav class="sidebar-nav">
      <a class="sidebar-nav-item" href="/">Home</a>

      

      
      
        
          
            <a class="sidebar-nav-item" href="http://localhost:4000/about.html">About</a>
          
        
      
        
      
        
          
        
      
        
          
            <a class="sidebar-nav-item" href="http://localhost:4000/project.html">Project</a>
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      

      <span class="sidebar-nav-item">Currently v3.0.0</span>
    </nav>

    <p>&copy; 2022. All rights reserved.</p>
  </div>
</div>


    <div class="content container">
      <div class="post">
  <h1 class="post-title">Spectrum SoC</h1>
  <span class="post-date">29 Jan 2022</span>
  <h2 id="building-the-soc">Building the SoC</h2>
<p>So we would use chisel (scala library) to build and test the SoC. For in depth testing one can convert to verilog and test on a lower level, or convert to C++ afterwards as well. If wanting to simulate on software, will prob have to use verilator for performance and accuracy.</p>

<h2 id="generating-verilog">Generating Verilog</h2>
<p>Say you have an app in chisel,</p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">object</span> <span class="nc">Main</span> <span class="k">extends</span> <span class="nc">App</span> <span class="o">{</span>
  <span class="o">(</span><span class="k">new</span> <span class="nv">chisel3</span><span class="o">.</span><span class="py">stage</span><span class="o">.</span><span class="py">ChiselStage</span><span class="o">).</span><span class="py">emitVerilog</span><span class="o">(</span><span class="k">new</span> <span class="nc">CPU</span><span class="o">,</span> <span class="n">args</span><span class="o">)</span>
<span class="o">}</span></code></pre></figure>

<p>Will generate verilog for your <code class="language-plaintext highlighter-rouge">CPU</code> class. I think it is systemverilog, though Im not 100% sure. Also idk if Verilog and SystemVerilog is both compatible with Verilator since they seem to suggest they only support one or the other or something.</p>

<h2 id="generating-c-and-simulating">Generating C++ and Simulating</h2>
<p>So you do <code class="language-plaintext highlighter-rouge">verilator --cc &lt;verilog files&gt; --Mdir &lt;output_dir&gt; --exe</code> to transpile verilog to executable c++ code. You can also specify <code class="language-plaintext highlighter-rouge">--build cmake</code> to use cmake to build the code into an executable for your platform.</p>

<p>To increase simulation performance, can use <code class="language-plaintext highlighter-rouge">--threads 6</code> to transpile with verilator. This generates code that uses multiple threads.</p>

<p>Btw instead of running verilator directly you can use cmake for the whole thing, e.g.</p>

<figure class="highlight"><pre><code class="language-cmake" data-lang="cmake"><span class="nb">project</span><span class="p">(</span>cmake_example<span class="p">)</span>
<span class="nb">find_package</span><span class="p">(</span>verilator HINTS $ENV{VERILATOR_ROOT}<span class="p">)</span>
<span class="nb">add_executable</span><span class="p">(</span>Vour sim_main.cpp<span class="p">)</span>
<span class="nf">verilate</span><span class="p">(</span>Vour SOURCES our.v<span class="p">)</span></code></pre></figure>

<p>Verilates the verilog to c++ and compiles it to an executable <code class="language-plaintext highlighter-rouge">Vour</code>.</p>

<h2 id="connnecting-to-the-model">Connnecting to the Model</h2>
<p>To hook onto the output model, verilate the verilog which produces <code class="language-plaintext highlighter-rouge">{prefix}.h</code>. Inside contains a <code class="language-plaintext highlighter-rouge">{prefix}</code> class. It contains the interface for your model. So Im guessing here you can e.g. connect an SSD to one of its ports using another model. You would do it in <code class="language-plaintext highlighter-rouge">{prefix}.cpp</code>.</p>

<p>Well ok.</p>

</div>


<div class="related">
  <h2>Related posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="http://localhost:4000/2022/02/14/update-spectro.html">
            Spectro Update
            <small>14 Feb 2022</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="http://localhost:4000/2022/02/10/update.html">
            Spectro Update
            <small>10 Feb 2022</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="http://localhost:4000/2022/02/08/spectro-update.html">
            What to do?
            <small>08 Feb 2022</small>
          </a>
        </h3>
      </li>
    
  </ul>
</div>


    </div>

  </body>
</html>
