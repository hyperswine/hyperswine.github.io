"use strict";(self.webpackChunkprojects=self.webpackChunkprojects||[]).push([[8261],{3905:(e,t,n)=>{n.d(t,{Zo:()=>l,kt:()=>h});var r=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var c=r.createContext({}),p=function(e){var t=r.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):a(a({},t),e)),n},l=function(e){var t=p(e.components);return r.createElement(c.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,o=e.mdxType,i=e.originalType,c=e.parentName,l=s(e,["components","mdxType","originalType","parentName"]),d=p(n),h=o,m=d["".concat(c,".").concat(h)]||d[h]||u[h]||i;return n?r.createElement(m,a(a({ref:t},l),{},{components:n})):r.createElement(m,a({ref:t},l))}));function h(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=n.length,a=new Array(i);a[0]=d;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s.mdxType="string"==typeof e?e:o,a[1]=s;for(var p=2;p<i;p++)a[p]=n[p];return r.createElement.apply(null,a)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},829:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>a,default:()=>u,frontMatter:()=>i,metadata:()=>s,toc:()=>p});var r=n(7462),o=(n(7294),n(3905));const i={sidebar_position:1},a="Spectre System",s={unversionedId:"base/spectre-system",id:"base/spectre-system",title:"Spectre System",description:"Spectre",source:"@site/docs/base/spectre-system.md",sourceDirName:"base",slug:"/base/spectre-system",permalink:"/docs/base/spectre-system",draft:!1,tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"main",next:{title:"Neutron",permalink:"/docs/base/neutron"}},c={},p=[{value:"Spectre-U and Spectre-S",id:"spectre-u-and-spectre-s",level:2},{value:"Executors",id:"executors",level:2},{value:"Functions",id:"functions",level:3},{value:"Peripheral Communication",id:"peripheral-communication",level:3},{value:"Spectre ISA",id:"spectre-isa",level:2}],l={toc:p};function u(e){let{components:t,...i}=e;return(0,o.kt)("wrapper",(0,r.Z)({},l,i,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"spectre-system"},"Spectre System"),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Spectre",src:n(2730).Z,width:"1452",height:"617"})),(0,o.kt)("p",null,"The ",(0,o.kt)("a",{parentName:"p",href:"https://hyperswine.github.io/spectre"},"spectre system")," is a computing platform that is built from first principles.\nMinimalism, user-centric, efficiency and scalablility are philosophies I like."),(0,o.kt)("h2",{id:"spectre-u-and-spectre-s"},"Spectre-U and Spectre-S"),(0,o.kt)("p",null,"Spectre User is the user optimised configuration of the spectre system. It is the config that you and I would want to use on daily basis in our smartphones, watches, laptops, etc. There is a subset of Spectre-S (Spectre-E) that is used in embedded."),(0,o.kt)("p",null,"Spectre Server is the high end optimised configuration of the spectre system. Instead of focusing on efficiency, heat generation, etc. We mainly focus on scalability and the highest performance possible."),(0,o.kt)("hr",null),(0,o.kt)("h2",{id:"executors"},"Executors"),(0,o.kt)("p",null,"How does spectre work exactly?"),(0,o.kt)("p",null,"The central concept is the executor. An executor is a hardware unit whose job is to execute a ",(0,o.kt)("inlineCode",{parentName:"p"},"function"),". We also have something known as an array executor of a certain size, e.g. 4096 bits. An array executor can be seen as an SIMD unit. Finally we have accelerator type executors for rapid, low latency SHA-256 and etc. This is for Spectre-U; for Spectre-S, we may instead optimise for higher throughput."),(0,o.kt)("admonition",{type:"tip"},(0,o.kt)("p",{parentName:"admonition"},"The three main types of executors:"),(0,o.kt)("ul",{parentName:"admonition"},(0,o.kt)("li",{parentName:"ul"},"I-type executors"),(0,o.kt)("li",{parentName:"ul"},"D-type SIMD/T executors"),(0,o.kt)("li",{parentName:"ul"},"A-type executors"))),(0,o.kt)("p",null,"A spectre instruction targets a specific executor. It first gets decoded in decode stage 1 and placed into queue stage 1. There it is dequeued to a chosen executor cluster. It is then decoded again and queued to execute in an available executor suited for it."),(0,o.kt)("p",null,"Like gpgpu shader clusters, executor complexes can be seen as SIMT-able units."),(0,o.kt)("h3",{id:"functions"},"Functions"),(0,o.kt)("p",null,'Functions are defined as parameterised blocks of code to be "called" into, ran from start to finish, and be "returned" from.'),(0,o.kt)("p",null,"The spectre architecture knows of functions in the above form. The first thing that's run on a spectre system is the ",(0,o.kt)("inlineCode",{parentName:"p"},"_entry")," function of a process. The first process to exist is the BIOS firmware process, which is semi hardcoded into the uarch. All subsequent processes follow a similar route of entry. Each time a process exits it returns from ",(0,o.kt)("inlineCode",{parentName:"p"},"_entry")," to the caller. In the context of userspace applications, this is the in memory scheduler driver library. In the context of the kernel, it is the bootloader and BIOS, and eventually the ",(0,o.kt)("inlineCode",{parentName:"p"},"_reset")," instruction which is like a hard return."),(0,o.kt)("p",null,"Functions are called by jumping to their absolute addresses, or relative addresses if you want to save memory. All arguments passed to the function would be saved onto the thread's stack beforehand. The way it does so is through the spectre calling convention. Its actually quite simple:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-rust"},"// language code\nf: (int: i32) => int + 1\n\nf()\n\n// machine code\nf:\n    store $sp + 1\n    jump $sp - size_of_args\n\ncallee:\n    store return_addr\n    store int\n    jump f\n    // would then pop/yield if need be \n")),(0,o.kt)("p",null,"Now would it possibly use more memory sometimes? Maybe. But I think it is a worthy tradeoff for efficiency."),(0,o.kt)("h3",{id:"peripheral-communication"},"Peripheral Communication"),(0,o.kt)("p",null,"Any device or system not embedded on the main system (usually the SoC) itself would require peripheral protocols. These include PCIe, USB, Motherboard bus, etc."),(0,o.kt)("p",null,'Furthermore, the latency (and possibly throughput) associated with peripheral communication are orders of magnitude slower than inter-SoC communication. "Functions" executed by peripheral systems may also be subject to sporadic user input, unstable internet connections, etc. Hence the concept of direct function execution cannot be applied as easily. Instead, a hardware based effect system is used to manage and wait on peripheral systems which may take their time to reply.'),(0,o.kt)("p",null,"We refer to peripheral communication as IO. Most IO are performed through memory mapped reads and writes. A userspace application would link a driver in execute only mode and call it through a library each time it wants to e.g. read from disk, communicate with devices and computers through the wireless card. The driver code may request a DMA transaction by writing to the memory mapped DMA controller with the request struct. If not contentious, the request would be promptly processed and the controller would stream the request packet to the desired device."),(0,o.kt)("hr",null),(0,o.kt)("h2",{id:"spectre-isa"},"Spectre ISA"),(0,o.kt)("p",null,"The spectre system is unique in that is has a uniform instruction set. That means to program all executors you simply use the same context. Unlike cpu-gpu splits where you have to program each separately through e.g. shaders."),(0,o.kt)("p",null,"The spectre ISA is quite simple. It consists of like 10 atomic instructions:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-rust"},"Instruction: enum\n  // Scalar Computation (Int/Float, 8,16,32,64,128 - reuses 128-bits)\n  Add\n  Sub\n  Mult\n  Div\n  Modulo\n  MultiplyAccumulate\n  // Logic\n  And\n  Or\n  Xor\n  Not\n  Shift\n  // Vector Computation\n  Map\n  // Control\n  Jump\n  // Memory Access\n  Copy\n  // Acceleration\n  Sha256\n  Lookup\n  FourierTransform\n")),(0,o.kt)("p",null,"Despite being a stack machine of sorts, there is no explicit ",(0,o.kt)("inlineCode",{parentName:"p"},"Store")," instruction. Instead, it is built into certain arithmetic and bitwise instructions to redirect the output to the stack pointer, and an option to increment it by that amount. There are also options to overwrite the stack pointer so if your using a linear atomic value, it just gets used up in that instruction."),(0,o.kt)("admonition",{type:"note"},(0,o.kt)("p",{parentName:"admonition"},(0,o.kt)("strong",{parentName:"p"},"Chip Design")),(0,o.kt)("p",{parentName:"admonition"},"The latest SoA designs use chiplets and die stacking. As well as maximising the bandwidth of buses. Spectre utilises SoC based chiplets for combining executor clusters, memory units, and caches. It forces as many components together as possible and utilises wireless networking where possible to interface with peripheral devices. Gone are the days of USB, HDMI, PCIe, or what have you. Everything is packaged together nicely and can be upgraded together if you wish to reuse the chassis or the board."),(0,o.kt)("p",{parentName:"admonition"},"Less is more.")),(0,o.kt)("hr",null),(0,o.kt)("p",null,":::"),(0,o.kt)("hr",null),(0,o.kt)("script",{type:"module",src:"https://unpkg.com/giscus?module"}),(0,o.kt)("script",{src:"https://giscus.app/client.js","data-repo":"hyperswine/hyperswine.github.io","data-repo-id":"R_kgDOGm36XA","data-category":"Q&A","data-category-id":"DIC_kwDOGm36XM4CcCgF","data-mapping":"pathname","data-strict":"0","data-reactions-enabled":"1","data-emit-metadata":"0","data-input-position":"bottom","data-theme":"preferred_color_scheme","data-lang":"en",crossorigin:"anonymous",async:!0}))}u.isMDXComponent=!0},2730:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/Spectre-a175f13589cec4333fb8d5370bf2b062.png"}}]);